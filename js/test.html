<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Test</title>
</head>
<body>
   <canvas width = "300" height = "150" id="test"></canvas> 
   <div id = "output">
       <div id="mouseUp"></div>
       <div id="mouseDown"></div>
       <div id="mouseAngle"></div>
   </div>
   <script type = "text/javascript">
    (function(w, d, s) {

        let id = d.querySelector("#test");
        let context = id.getContext("2d");
        
        let mouseUp = d.querySelector("#mouseUp");
        let mouseDown = d.querySelector("#mouseDown");
        let mouseAngle = d.querySelector("#mouseAngle");

        let mouse = {
            up : [],
            down : [],
            touch : false,
            delta : {
                x : void 0,
                y : void 0
            },
            angle : void 0,
            magnitude : void 0
        }


        id.addEventListener("mousedown", function(e) {
            mouse.touch = true;
            mouse.down[0] = e.clientX;
            mouse.down[1] = e.clientY;
        });

        id.addEventListener("mouseup", function(e) {
            mouse.touch = false;
        });

        id.addEventListener("mousemove", function(e) {
            if(mouse.touch) {
                
                mouse.up[0] = e.clientX;
                mouse.up[1] = e.clientY;

                mouse.delta.x = (
                    mouse.up[0] - mouse.down[0]
                );
                mouse.delta.y = (
                    mouse.up[1] - mouse.down[1]
                );
                mouse.magnitude = Math.sqrt(
                    mouse.delta.x ** 2 + mouse.delta.y ** 2
                );

                //Work here using atan2 function which has the angle interval [-pi, pi]
                let theta = Math.atan2(
                    -mouse.delta.y , mouse.delta.x
                );

                theta = (theta > 0) ? 2 * Math.PI - theta: theta * -1;
                mouse.angle = theta;
            }
        });

        function updateDOM() {

            mouseUp.innerHTML = "X:" + mouse.up[0] + " : " + "Y:" + mouse.up[1] + "<br />";
                mouseDown.innerHTML = "X:" + mouse.down[0] + " : " + "Y:" + mouse.down[1] + "<br />";
                mouseAngle.innerHTML = "Theta: " + mouse.angle
        }

        function drawBlack() {
            context.beginPath();
            context.moveTo(
                mouse.down[0], mouse.down[1]
            );
            context.lineTo(
                mouse.up[0], mouse.up[1]
            );
            context.strokeStyle = "#000";
            context.stroke();
            context.closePath();
        }

        function drawRed() {

            let x = mouse.down[0];
            let y = mouse.down[1];

            context.beginPath();
            context.strokeStyle = "#f00";
            
            context.moveTo(x, y);
            context.lineTo(
                x + mouse.magnitude * Math.cos(mouse.angle),
                y + mouse.magnitude * Math.sin(mouse.angle)
            )

            context.stroke();
            context.closePath();

        }

        function loop() {
            if(mouse.touch) {

                context.clearRect(0, 0, context.canvas.width, context.canvas.height);
                
                drawBlack();

                drawRed();

                updateDOM();
                
            }
            w.requestAnimationFrame(loop);
        }

        loop();

    })(window, document, screen);
   </script>
</body>
</html>